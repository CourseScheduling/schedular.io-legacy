var TEACHER_RATING_AVERAGE=3.6679156419657004,RANDOM_ERROR=.03601469;CORE={raw_data:RAW_COURSE_DATA,scheduleOptions:{all:[]},courseData:{map:{},array:[]},main:{teacher:{ratings:{map:{}}},parse:{},search:{depther:{}},schedule:{}},helper:{time:{},hook:{}},sort:{functions:{type:"Starting Time",time:{mornings:null,noon:null,evenings:null,timeOfDay:"mornings"},blockAmount:null},type:""},view:{toolTip:{},customElements:{},controlPanel:{timeSort:{}},show:{}},socket:{}};CORE.helper.hook=function(c){};
CORE.helper.time=function(c){return{getMinutes:function(b){b=b.split(":");return 60*parseInt(b[0])+1*parseInt(b[1])},inTime:function(b,a,d,c){return isNaN(b)||isNaN(d)?!1:d>=b&&d<a||c>b&&c<a||b>=d&&b<c||a>d&&a<c?!0:!1},sameDay:function(b,a){if(-1===b[0]||-1===a[0])return!1;for(var d=0;d<b.length;d++)if(-1<a.indexOf(b[d]))return!0;return!1}}}(CORE);
CORE.helper.color=function(c){return{changeTint:function(b,a){var d=parseInt(b,16);return((d&255)+a|(d>>8&255)+a<<8|(d>>16)+a<<16).toString(16)},getTextColor:function(b){b=b.substr(1);var a=parseInt(b.substr(0,2),16),d=parseInt(b.substr(2,2),16);b=parseInt(b.substr(4,2),16);return 150<=(299*a+587*d+114*b)/1E3?"#222222":"#eeeeee"},getBackgroundColor:function(b){return"#"+this.changeTint(("000000"+(parseInt(parseInt(b,36).toExponential().slice(2,-5),10)&16777215).toString(16).toUpperCase()).slice(-6),
0)}}}(CORE);CORE.helper.element=function(c){return{changeStyle:function(b,a){for(var d in a)b.style[d]=a[d]},createDiv:function(b){var a=document.createElement("div"),d;for(d in b)a.setAttribute(d,b[d]);return a}}}(CORE);
CORE.main.parse=function(c){c.raw_data.forEach(function(a,b,f){c.main.teacher.ratings.map[a.instructor.slice(0,-1)]=1;courseKey=[a.subject,a.code,"|",-1===a.section.indexOf("#")?"":"LAB"].join("");a.days="-1"==a.days?[-1]:a.days.split("").map(Number);a.courseCode=a.subject+a.code;a.endTime=c.helper.time.getMinutes(a.endTime);a.startTime=c.helper.time.getMinutes(a.startTime);f=c.courseData.map[courseKey];if(void 0!==f){var h=!1;for(b=f.sections.length;b--;)if(f.sections[b].crn===a.CRN){h=!0;break}h?
f.sections[b].times.push({startTime:a.startTime,endTime:a.endTime,day:a.days,instructor:a.instructor}):f.sections.push({courseName:a.subject+a.code,crn:a.CRN,courseId:a.id,section:a.section,campus:a.campus,times:[{startTime:a.startTime,endTime:a.endTime,day:a.days,instructor:a.instructor}],students:{enrolled:0,waitlisted:0,max:0}})}else c.courseData.map[courseKey]={courseName:a.subject+a.code,lab:0,sections:[{courseName:a.subject+a.code,crn:a.CRN,courseId:a.id,section:a.section,campus:a.campus,times:[{startTime:a.startTime,
endTime:a.endTime,day:a.days,instructor:a.instructor}],students:{enrolled:0,waitlisted:0,max:0}}]}});for(var b in c.courseData.map)c.courseData.array.push(c.courseData.map[b])}(CORE);
CORE.sort.functions=function(c){return{type:"Starting Time",time:{mornings:function(b,a){for(var d=0,c=0,h=0,k=0,e=b.length;e--;)for(var g=b[e].times.length;g--&&-1!=b[e].times[g].day[0];)d+=b[e].times[g].startTime*b[e].times[g].day.length,h+=b[e].times[g].day.length;for(e=a.length;e--;)for(g=a[e].times.length;g--&&-1!=a[e].times[g].day[0];)c+=a[e].times[g].startTime*a[e].times[g].day.length,k+=a[e].times[g].day.length;return d/h-c/k},noon:function(b,a){for(var d=0,c=0,h=0,k=0,e=b.length;e--;)for(var g=
b[e].times.length;g--&&-1!=b[e].times[g].day[0];)d+=Math.abs((b[e].times[g].startTime-b[e].times[g].endTime)/2-720)*b[e].times[g].day.length,h+=b[e].times[g].day.length;for(e=a.length;e--;)for(g=a[e].times.length;g--&&-1!=a[e].times[g].day[0];)c+=Math.abs((a[e].times[g].startTime-a[e].times[g].endTime)/2-720)*a[e].times[g].day.length,k+=a[e].times[g].day.length;return c/k-d/h},evenings:function(b,a){for(var d=0,c=0,h=0,k=0,e=b.length;e--;)for(var g=b[e].times.length;g--&&-1!=b[e].times[g].day[0];)d+=
b[e].times[g].startTime*b[e].times[g].day.length,h+=b[e].times[g].day.length;for(e=a.length;e--;)for(g=a[e].times.length;g--&&-1!=a[e].times[g].day[0];)c+=a[e].times[g].startTime*a[e].times[g].day.length,k+=a[e].times[g].day.length;return c/k-d/h},timeOfDay:"mornings"},teacherRating:function(b,a){},blockAmount:function(b,a){return a.times.length-b.times.length}}}(CORE);
CORE.sort.functions.start=function(c){return function(){document.getElementById("main-loadingGear").style.display="block";document.getElementById("main-scheduleContainer").innerHTML="";setTimeout(function(){c.main.show.current=0;switch(c.sort.functions.type){case "Starting Time":var b=(new Date).getTime();c.scheduleOptions.current.sort(c.sort.functions.time[c.sort.functions.time.timeOfDay]);break;case "Teacher Rating":b=(new Date).getTime(),c.scheduleOptions.current.sort(c.sort.functions.teacherRating)}console.log("Sorting Took: "+
(Date.now()-b)+"ms");document.getElementById("main-loadingGear").style.display="none";c.main.show.go(0)},10)}}(CORE);
CORE.filter=function(c){DBKey={ABBY:"Abbotsford",CHIL:"Chilliwack",HOPE:"Hope",MIS:"Mission",ONL:"Online",CLEAR:"Clearbrook"};return{campus:function(){var b=[],a=c.view.controlPanel.campusFilter.campusOn,d;for(d in a)a[d]||b.push(DBKey[d]);a=Date.now();c.scheduleOptions.current=c.scheduleOptions.all.filter(function(a){for(var c=a.length;c--;)if(-1<b.indexOf(a[c].campus))return!1;return!0});console.log("Filtering Took: "+(Date.now()-a)+"ms")}}}(CORE);
CORE.main.show=function(c){return{current:0,go:function(b){b=this.current||b;var a=10;b>=c.scheduleOptions.current.length-10&&(a=c.scheduleOptions.current.length-b);for(var d=b;d<b+a;d++){var f=c.main.schedule.generate(c.scheduleOptions.current[d]);document.getElementById("main-scheduleContainer").appendChild(f)}this.current+=10;return b},init:function(){window.onscroll=function(b){currentScroll=document.documentElement.scrollTop?parseInt(document.documentElement.scrollTop):parseInt(document.body.scrollTop);
parseInt(currentScroll)>=400*c.main.show.current&&c.main.show.go()}}}}(CORE);CORE.main.teacher.functions=function(c){return{fetch:function(b){var a=Object.keys(c.main.teacher.ratings.map);$.get({url:["/s/getTeacher?teachers=",JSON.stringify(a)].join(""),done:function(a){try{a.forEach(function(a,b,d){c.main.teacher.ratings.map[a.teacherName]=a.teacherRating}),b&&b()}catch(f){console.log(f)}}})},onFetched:function(){}}}(CORE);var counter=0;
CORE.main.search=function(c){return{depther:function(b,a){if(0>a)c.scheduleOptions.all.push(b);else{var d=c.courseData.array,f=d[a].sections.length;a:for(;f--;){for(var h=b.length;h--;){if(b[h].courseName===d[a].sections[f].courseName&&b[h].campus!==d[a].sections[f].campus&&"Online"!==b[h].campus)continue a;for(var k=b[h].times.length;k--;)for(var e=d[a].sections[f].times.length;e--;){var g=b[h].times[k],l=d[a].sections[f].times[e];if(c.helper.time.sameDay(g.day,l.day)&&c.helper.time.inTime(g.startTime,
g.endTime,l.startTime,l.endTime))continue a}}0==a?c.scheduleOptions.all.push(b.concat([d[a].sections[f]])):c.main.search.depther(b.concat([d[a].sections[f]]),a-1)}}},init:function(b){setTimeout(function(){var a=(new Date).getTime();c.courseData.array[c.courseData.array.length-1].sections.forEach(function(a,b,h){c.main.search.depther([a],c.courseData.array.length-2)});console.log("Scheduling Took: "+(Date.now()-a)+"ms");c.scheduleOptions.current=c.scheduleOptions.all;b&&b()},50)}}}(CORE);
CORE.main.schedule=function(c){return{makeBlock:function(b,a,d){if(-1==d)return document.createTextNode("");var f=c.helper.element.createDiv({"class":"s-timeBlock"});c.helper.element.changeStyle(f,{top:[(a.startTime-480)/2,"px"].join(""),left:[71*(d+1),"px"].join(""),height:[(a.endTime-a.startTime)/2,"px"].join(""),lineHeight:[(a.endTime-a.startTime)/2,"px"].join(""),color:c.helper.color.getTextColor(c.helper.color.getBackgroundColor(b.courseName)),backgroundColor:c.helper.color.getBackgroundColor(b.courseName)});
f.innerHTML=b.courseName;return f},generate:function(b){var a=document.getElementById("scheduleWrapTemplate").cloneNode(!0);a.id="";b.forEach(function(b,f,h){b.times.forEach(function(h,e,f){h.day.forEach(function(e,f,g){e=c.main.schedule.makeBlock(b,h,e);ToolTipMod.add(e,b);a.getElementsByClassName("s-timeBlockWrap")[0].appendChild(e)})})});document.body.appendChild(a);return a}}}(CORE);
CORE.view.controlPanel.timeSort=function(c){var b=document.getElementById("timeSort-wrap");(function(a){a.forEach(function(a,b,c){var k=document.getElementById("timeSort-upper");c=document.createElement("span");k.appendChild(c);c.innerHTML=a;c.className="timeSort-label";c.setAttribute("data-labelValue",a);a=c.offsetWidth;b+=1;c.style.marginLeft=20*(b-1)+10+50*(b-1)-a/2+"px";c.style.display="none"})})(["Mornings","Noon","Evenings"]);[].slice.call(document.getElementsByClassName("timeSort-ball")).forEach(function(a,
b,f){a.addEventListener("click",function(){if(a!==b&&!c.view.controlPanel.timeSort.disabled){var b=document.getElementById("timeSort-ball-active"),d=b&&b.getAttribute("data-value");b&&(b.id="",document.querySelectorAll('[data-labelValue="'+d+'"]')[0].style.display="none");b=a.getAttribute("data-value");a.id="timeSort-ball-active";document.querySelectorAll('[data-labelValue="'+b+'"]')[0].style.display="";c.sort.functions.time.timeOfDay=b.toLowerCase();c.sort.functions.time.type="Starting Time";c.sort.functions.start()}})});
return{disabled:!1,activate:function(a){var b=document.getElementById("timeSort-ball-active"),f=b&&b.getAttribute("data-value");b&&(b.id="",document.querySelectorAll('[data-labelValue="'+f+'"]')[0].style.display="none");b=a.getAttribute("data-value");a.id="timeSort-ball-active";document.querySelectorAll('[data-labelValue="'+b+'"]')[0].style.display="";c.sort.functions.time.timeOfDay=b.toLowerCase();c.sort.functions.time.type="Starting Time";c.sort.functions.start()},disable:function(){b.style.opacity=
"0.6";c.view.controlPanel.timeSort.disabled=!0},enable:function(){b.style.opacity="1";c.view.controlPanel.timeSort.disabled=!1;c.sort.functions.type="Starting Time"}}}(CORE);
CORE.view.customElements.checkBoxes=function(c){var b={onClick:function(a){"false"==a.target.getAttribute("checked")?(a.target.setAttribute("checked",!0),a.target.classList.add("customCheckbox-checked")):(a.target.setAttribute("checked",!1),a.target.classList.remove("customCheckbox-checked"));b.globalExt(a)},globalExt:function(a){},addExt:function(a,b){[].slice.call(document.querySelectorAll('[data-uniqID="'+a+'"]')).forEach(function(a,c,k){a.addEventListener("mousedown",function(a){a.shiftKey||b&&
b(a)})})}};[].slice.call(document.getElementsByClassName("customCheck")).forEach(function(a,d,f){d=a.getAttribute("data-keep");var h={checked:!1,"class":""};d&&d.split(" ").forEach(function(b,c,d){h[b]=a.getAttribute(b)});h["class"]+=" customCheckBox";d=c.helper.element.createDiv(h);d.addEventListener("mousedown",b.onClick);a.parentNode.replaceChild(d,a)});return b}(CORE);
CORE.view.controlPanel.campusFilter=function(c){[{name:"Abbotsford",uniq:"ABBY",check:null},{name:"Chilliwack",uniq:"CHIL",check:null},{name:"Hope",uniq:"HOPE",check:null},{name:"Mission",uniq:"MIS",check:null},{name:"Clearbrook",uniq:"CLEAR",check:null},{name:"Online",uniq:"ONL",check:null}].forEach(function(b,a,d){c.view.customElements.checkBoxes.addExt(b.uniq,function(a){"true"==a.target.getAttribute("checked")?c.view.controlPanel.campusFilter.campusOn[b.uniq]=!0:c.view.controlPanel.campusFilter.campusOn[b.uniq]=
!1;c.filter.campus(b.uniq);c.sort.functions.start()})});return{campusOn:{ABBY:!0,CHIL:!0,HOPE:!0,MIS:!0,ONL:!0,CLEAR:!0}}}(CORE);
CORE.view.controlPanel.sortDrop=function(c){var b=document.getElementById("sort-dropDownList"),a=document.getElementById("sort-dropDownButton");document.addEventListener("click",function(a){if(c.view.controlPanel.sortDrop.down&&!a.target.classList.contains("sort-dropDownItem"))c.view.controlPanel.sortDrop.move.up();else if(a.target.classList.contains("sort-dropDownItem"))switch(document.querySelectorAll('[data-value="'+c.view.controlPanel.sortDrop.currentValue+'"]')[0].style.display="block",a.target.style.display=
"none",c.view.controlPanel.sortDrop.move.up(),c.view.controlPanel.sortDrop.setWords(a.target.getAttribute("data-value")),a.target.getAttribute("data-value")){case "Teacher Rating":c.sort.functions.type="Teacher Rating";c.view.controlPanel.timeSort.disable();c.sort.functions.start();break;case "Starting Time":c.sort.functions.type="Starting Time",c.view.controlPanel.timeSort.enable(),c.sort.functions.start()}});a.addEventListener("click",function(d){d.stopPropagation();c.view.controlPanel.sortDrop.down?
(a.style.backgroundImage="",c.view.controlPanel.sortDrop.down=!1,Velocity(b,"slideUp",100)):(a.style.backgroundImage="url(/images/upArrow.png)",c.view.controlPanel.sortDrop.down=!0,Velocity(b,"slideDown",100))});return{setWords:function(b){a.innerHTML='Sort By <label style="font-weight:100">|</label><label style="font-weight:300;"> '+b+"</label>";c.view.controlPanel.sortDrop.currentValue=b},down:!1,currentValue:"Starting Time",move:{down:function(){a.style.backgroundImage="url(../images/upArrow.png)";
c.view.controlPanel.sortDrop.down=!0;Velocity(b,"slideDown",100)},up:function(){a.style.backgroundImage="";c.view.controlPanel.sortDrop.down=!1;Velocity(b,"slideUp",100)}}}}(CORE);
ToolTipMod={generate:function(c,b){var a=document.getElementById("t-toolTipWrap");a.style.display="block";var d=document.body.getBoundingClientRect(),f=c.target.getBoundingClientRect(),h=f.top-d.top,d=f.left-d.left;console.log(f.height);a.style.top=h+80+f.height+"px";a.style.left=d-150+"px"},onHover:function(c,b){ToolTipMod.generate(c,b);var a={0:"Monday",1:"Tuesday",2:"Wednesday",3:"Thursday",4:"Friday",5:"Saturday",6:"Sunday"},d=document.getElementById("t-toolTipCourseName");d.innerHTML=[b.subject,
b.code,'<label style="float:right;">',b.section,"</label>"].join("");d.style.color=ColorMod.getBackgroundColor(b.subject+b.code);var f=document.getElementById("t-toolTipCRN"),h=document.getElementById("t-toolTipInstructor"),d=document.getElementById("t-toolTipRating"),k=document.getElementById("t-toolTipImage");f.innerHTML="CRN: "+b.CRN;h.innerHTML=b.instructor;0<TeacherMod.teachers[b.instructor]?(k.style.background="",f=parseFloat(TeacherMod.ratedTeachers[TeacherMod.teachers[b.instructor]].teacherRating),
d.innerHTML=f.toFixed(3),3<=f?k.style.backgroundPosition="10px 10px":3>f&&2<=f?k.style.backgroundPosition="-40px 10px":2>f&&(k.style.backgroundPosition="-100px 10px")):(d.innerHTML="N/A",k.style.background="#DDD");document.getElementById("t-toolTipTimes").innerHTML="";for(d=0;d<b.days.length&&!isNaN(b.days[d]);d++)document.getElementById("t-toolTipTimes").innerHTML+=["<strong>",a[b.days[d]],": </strong>",b.startTime," - ",b.endTime,"<br>"].join("")},onMove:function(c,b){document.getElementById("t-toolTipWrap").style.display=
"none"},add:function(c,b){var a=this;c.addEventListener("mouseover",function(c){a.onHover(c,b)});c.addEventListener("mouseout",function(c){a.onMove(c,b)})}};CORE.socket=function(c){}(CORE);(function(){CORE.main.search.init(function(){CORE.main.teacher.functions.fetch(function(){CORE.sort.functions.type="Starting Time";CORE.view.controlPanel.timeSort.activate(document.getElementsByClassName("timeSort-ball")[0])});CORE.main.show.init()})})();