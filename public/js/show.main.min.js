var TEACHER_RATING_AVERAGE=3.6679156419657004,STANDARD_DEVIATION=1.0229023978801683;localStorage.RAW_COURSE_DATA=JSON.stringify(RAW_COURSE_DATA);
CORE={raw_data:RAW_COURSE_DATA,scheduleOptions:{all:[],current:[]},courseData:{map:{},array:[]},main:{teacher:{ratings:{map:{}}},parse:{},search:{depther:{}},schedule:{}},helper:{time:{},hook:{}},sort:{functions:{type:"Starting Time",time:{mornings:null,noon:null,evenings:null,timeOfDay:"mornings"},blockAmount:null},type:""},view:{schedule:{},toolTip:{},customElements:{},controlPanel:{timeSort:{}},show:{},daySlider:{elements:{mon:[],tue:[],wed:[],thu:[],fri:[],sat:[]}}},socket:{seatMap:{}}};
CORE.helper.hook=function(c){};
CORE.helper.time=function(c){return{getTime:function(a){var b=parseInt(a/60);a%=60;return 12<b?[b-12,":",a," pm"].join(""):[b,":",a," am"].join("")},getMinutes:function(a){a=a.split(":");return 60*parseInt(a[0])+1*parseInt(a[1])},inTime:function(a,b,d,c){return isNaN(a)||isNaN(d)?!1:d>=a&&d<b||c>a&&c<b||a>=d&&a<c||b>d&&b<c?!0:!1},outTime:function(a,b,d,c){return isNaN(a)||isNaN(d)||a>=d&&c>=b?!1:!0},sameDay:function(a,b){if(-1===a[0]||-1===b[0])return!1;for(var d=0;d<a.length;d++)if(-1<b.indexOf(a[d]))return!0;
return!1}}}(CORE);
CORE.helper.color=function(c){return{changeTint:function(a,b){a=String(a).replace(/[^0-9a-f]/gi,"");6>a.length&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);b=b||0;var d="",c,e;for(e=0;3>e;e++)c=parseInt(a.substr(2*e,2),16),c=Math.round(Math.min(Math.max(0,c+c*b),255)).toString(16),d+=("00"+c).substr(c.length);return d},getTextColor:function(a){a=a.substr(1);var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16);a=parseInt(a.substr(4,2),16);return 105>255-(.299*b+.587*c+.114*a)?"#222222":"#ffffff"},getBackgroundColor:function(a){return"#"+
this.changeTint(("000000"+(parseInt(parseInt(a,36).toExponential().slice(2,-5),10)&16777215).toString(16).toUpperCase()).slice(-6),.1)}}}(CORE);CORE.helper.element=function(c){return{changeStyle:function(a,b){for(var c in b)a.style[c]=b[c]},createDiv:function(a){var b=document.createElement("div"),c;for(c in a)b.setAttribute(c,a[c]);return b}}}(CORE);
CORE.main.parse=function(c){c.raw_data.forEach(function(b,a,f){b.instructor=b.instructor.slice(0,-1);c.main.teacher.ratings.map[b.instructor]=-.001;courseKey=[b.subject,b.code,"|",-1===b.section.indexOf("#")?"":"LAB"].join("");b.courseCode=b.subject+b.code;b.endTime=c.helper.time.getMinutes(b.endTime);b.startTime=c.helper.time.getMinutes(b.startTime);var e={startTime:b.startTime,endTime:b.endTime,day:b.days,instructor:b.instructor};e.day="-1"==e.day?[-1]:e.day.split("").map(Number);f=c.courseData.map[courseKey];
if(void 0!==f){a=0;var h=!1;for(a=f.sections.length;a--;)if(f.sections[a].crn===b.CRN){h=!0;break}h?f.sections[a].times.every(function(b){return JSON.stringify(b)!==JSON.stringify(e)})&&f.sections[a].times.push(e):f.sections.push({courseName:b.subject+b.code,lab:-1!==b.section.indexOf("#"),crn:b.CRN,courseId:b.id,section:b.section,campus:b.campus,times:[e],students:{enrolled:0,waitlisted:0,max:0}})}else c.courseData.map[courseKey]={courseName:b.subject+b.code,sections:[{courseName:b.subject+b.code,
lab:-1!==b.section.indexOf("#"),crn:b.CRN,courseId:b.id,section:b.section,campus:b.campus,times:[e],students:{enrolled:0,waitlisted:0,max:0}}]}});for(var a in c.courseData.map)c.courseData.array.push(c.courseData.map[a])}(CORE);
CORE.sort.functions=function(c){return{type:"Starting Time",time:{mornings:function(a,b){for(var c=0,f=0,e=0,h=0,g=a.length;g--;)for(var k=a[g].times.length;k--&&-1!=a[g].times[k].day[0];)c+=a[g].times[k].startTime*a[g].times[k].day.length,e+=a[g].times[k].day.length;for(g=b.length;g--;)for(k=b[g].times.length;k--&&-1!=b[g].times[k].day[0];)f+=b[g].times[k].startTime*b[g].times[k].day.length,h+=b[g].times[k].day.length;return c/e-f/h},noon:function(a,b){for(var c=0,f=0,e=0,h=0,g=a.length;g--;)for(var k=
a[g].times.length;k--&&-1!=a[g].times[k].day[0];)c+=Math.abs(720-(a[g].times[k].startTime-a[g].times[k].endTime)/2),e++;for(g=b.length;g--;)for(k=b[g].times.length;k--&&-1!=b[g].times[k].day[0];)f+=Math.abs(720-(b[g].times[k].startTime-b[g].times[k].endTime)/2),h++;return c/e-f/h},evenings:function(a,b){for(var c=0,f=0,e=0,h=0,g=a.length;g--;)for(var k=a[g].times.length;k--&&-1!=a[g].times[k].day[0];)c+=a[g].times[k].startTime*a[g].times[k].day.length,e+=a[g].times[k].day.length;for(g=b.length;g--;)for(k=
b[g].times.length;k--&&-1!=b[g].times[k].day[0];)f+=b[g].times[k].startTime*b[g].times[k].day.length,h+=b[g].times[k].day.length;return f/h-c/e},timeOfDay:"mornings"},teacherRating:function(a,b){for(var d=0,f=0,e=0,h=0,g=a.length;g--;)d+=c.main.teacher.ratings.map[a[g].times[0].instructor],e++;for(g=b.length;g--;)f+=c.main.teacher.ratings.map[b[g].times[0].instructor],h++;return f/h-d/e},availability:function(a,b){for(var d=0,f=0,e=a.length;e--;)var h=c.socket.seatMap[a[e].crn],g=h.m-h.e,d=d+(1E3*
(0<g)-10*h.w+g*(0<g));for(e=b.length;e--;)h=c.socket.seatMap[b[e].crn],g=h.m-h.e,f+=1E3*(0<g)-10*h.w+g*(0<g);return f-d},blockAmount:function(c,b){return b.times.length-c.times.length}}}(CORE);
CORE.sort.functions.start=function(c){return function(){document.getElementById("main-loadingGear").style.display="block";document.getElementById("main-scheduleContainer").innerHTML="";setTimeout(function(){c.main.show.current=0;switch(c.sort.functions.type){case "Starting Time":var a=(new Date).getTime();c.scheduleOptions.current.sort(c.sort.functions.time[c.sort.functions.time.timeOfDay]);break;case "Teacher Rating":a=(new Date).getTime();c.scheduleOptions.current.sort(c.sort.functions.teacherRating);
break;case "Availability":a=(new Date).getTime(),c.scheduleOptions.current.sort(c.sort.functions.availability)}console.log("Sorting Took: "+(Date.now()-a)+"ms");document.getElementById("main-loadingGear").style.display="none";c.main.show.go(0)},10)}}(CORE);
CORE.filter=function(c){DBKey={ABBY:"Abbotsford",CHIL:"Chilliwack",HOPE:"Hope",MIS:"Mission",ONL:"Online",CLEAR:"Clearbrook"};return{on:["",""],time:function(a){var b=getValues();(a=a||!1)||c.filter.campus(!0);c.scheduleOptions.current=c.scheduleOptions[a?"all":"current"].filter(function(a){for(var f=a.length;f--;)for(var e=a[f].times.length;e--;)for(var h=a[f].times[e].day.length;h--;)if(void 0!=b.times[a[f].times[e].day[h]]&&c.helper.time.outTime(a[f].times[e].startTime,a[f].times[e].endTime,b.times[a[f].times[e].day[h]].start,
b.times[a[f].times[e].day[h]].end))return!1;return!0})},campus:function(a){(a=a||!1)||c.filter.time(!0);var b=[],d=c.view.controlPanel.campusFilter.campusOn,f;for(f in d)d[f]||b.push(DBKey[f]);if(0==b.length)return c.scheduleOptions.current=c.scheduleOptions.all.slice(0);d=Date.now();c.scheduleOptions.current=c.scheduleOptions[a?"all":"current"].filter(function(a){for(var c=a.length;c--;)if(-1<b.indexOf(a[c].campus))return!1;return!0});console.log("Filtering Took: "+(Date.now()-d)+"ms")}}}(CORE);
CORE.main.show=function(c){return{current:0,go:function(a){a=this.current||a;var b=10;a>=c.scheduleOptions.current.length-10&&(b=c.scheduleOptions.current.length-a);for(var d=a;d<a+b;d++){var f=c.view.schedule.generate(c.scheduleOptions.current[d]);document.getElementById("main-scheduleContainer").appendChild(f)}this.current+=10;c.socket.updateSeats();return a},init:function(){window.onscroll=function(a){currentScroll=document.documentElement.scrollTop?parseInt(document.documentElement.scrollTop):
parseInt(document.body.scrollTop);parseInt(currentScroll)>=400*c.main.show.current&&c.main.show.go()}}}}(CORE);
CORE.main.teacher.functions=function(c){return{generate:function(a,b){var d=a.getElementsByClassName("r-ratingContainer")[0],f=0,e=0;b.forEach(function(b,a,h){a=document.createElement("div");a.innerHTML+=['<div class="crn_',b.crn,'"style="float:left;border:1px solid #DDD;box-sizing:border-box;height:28px;margin-top:1px;padding-left:5px;padding-right:5px;line-height:28px;margin-right:10px;"><strong style="text-shadow:0 0px 1px #999" data-seatsCRN="',b.crn,'"></strong> seats left</div>','<strong style="color:'+
c.helper.color.getBackgroundColor(b.courseName)+'">',b.courseName,"</strong> ",b.section," ",b.times[0].instructor," <strong>",0<c.main.teacher.ratings.map[b.times[0].instructor]?c.main.teacher.ratings.map[b.times[0].instructor]:"","<strong><br>"].join("");d.appendChild(a);0<c.main.teacher.ratings.map[b.times[0].instructor]&&(f+=c.main.teacher.ratings.map[b.times[0].instructor],e++)});var h=document.createElement("div");h.className="r-averageRating";h.innerHTML=(f/e).toFixed(3);d.parentNode.insertBefore(h,
d)},fetch:function(a){var b=Object.keys(c.main.teacher.ratings.map);$.get({url:["/s/getTeacher?teachers=",JSON.stringify(b)].join(""),done:function(b){try{b.forEach(function(b,a,d){c.main.teacher.ratings.map[b.teacherName]=b.teacherRating}),a&&a()}catch(f){console.log(f)}}})},onFetched:function(){}}}(CORE);var counter=0;
CORE.main.search=function(c){return{depther:function(a,b){if(0>b)c.scheduleOptions.all.push(a);else{var d=c.courseData.array,f=d[b].sections.length;a:for(;f--;){for(var e=a.length;e--;){if(a[e].courseName===d[b].sections[f].courseName&&a[e].campus!==d[b].sections[f].campus&&"Online"!==a[e].campus)continue a;for(var h=a[e].times.length;h--;)for(var g=d[b].sections[f].times.length;g--;){var k=a[e].times[h],l=d[b].sections[f].times[g];if(c.helper.time.sameDay(k.day,l.day)&&c.helper.time.inTime(k.startTime,
k.endTime,l.startTime,l.endTime))continue a}}0==b?c.scheduleOptions.all.push(a.concat([d[b].sections[f]])):c.main.search.depther(a.concat([d[b].sections[f]]),b-1)}}},init:function(a){setTimeout(function(){var b=(new Date).getTime();c.courseData.array[c.courseData.array.length-1].sections.forEach(function(b,a,e){c.main.search.depther([b],c.courseData.array.length-2)});console.log("Scheduling Took: "+(Date.now()-b)+"ms");c.scheduleOptions.current=c.scheduleOptions.all;a&&a()},50)}}}(CORE);
function firstToUpperCase(c){return c.substr(0,1).toUpperCase()+c.substr(1)}
CORE.view.schedule=function(c){return{makeBlock:function(a,b,d){if(-1==d)return document.createElement("div");var f=c.helper.element.createDiv({"class":"s-timeBlock"});c.helper.element.changeStyle(f,{top:[(b.startTime-480)/2,"px"].join(""),left:[(d+1)%7*71,"px"].join(""),height:[(b.endTime-b.startTime)/2,"px"].join(""),lineHeight:[(b.endTime-b.startTime-4)/2,"px"].join(""),color:c.helper.color.getTextColor(c.helper.color.getBackgroundColor(a.courseName)),backgroundColor:c.helper.color.getBackgroundColor(a.courseName)});
f.innerHTML=a.courseName;return f},generate:function(a){var b=document.getElementById("scheduleWrapTemplate").cloneNode(!0),d=[];b.id="";a.forEach(function(a,e,h){d.push(a.crn);a.times.forEach(function(d,e,h){d.day.forEach(function(h,l,m){h=c.view.schedule.makeBlock(a,d,h);h.setAttribute("data-timeIndex",e);c.view.toolTip.add(h,a);b.getElementsByClassName("s-timeBlockWrap")[0].appendChild(h)})})});b.getElementsByClassName("s-useMeButton")[0].onclick=function(){localStorage.currentSchedule=d.join(".");
document.location="/s/builder#"+d.join(".")};c.main.teacher.functions.generate(b,a);document.getElementById("main-scheduleContainer").appendChild(b);return b}}}(CORE);
CORE.view.controlPanel.timeSort=function(c){var a=document.getElementById("timeSort-wrap");(function(b){b.forEach(function(b,a,c){var h=document.getElementById("timeSort-upper");c=document.createElement("span");h.appendChild(c);c.innerHTML=b;c.className="timeSort-label";c.setAttribute("data-labelValue",b);b=c.offsetWidth;a+=1;c.style.marginLeft=20*(a-1)+10+50*(a-1)-b/2+"px";c.style.display="none"})})(["Mornings","Noon","Evenings"]);[].slice.call(document.getElementsByClassName("timeSort-ball")).forEach(function(b,
a,f){b.addEventListener("click",function(){if(b!==a&&!c.view.controlPanel.timeSort.disabled){var a=document.getElementById("timeSort-ball-active"),d=a&&a.getAttribute("data-value");a&&(a.id="",document.querySelectorAll('[data-labelValue="'+d+'"]')[0].style.display="none");a=b.getAttribute("data-value");b.id="timeSort-ball-active";document.querySelectorAll('[data-labelValue="'+a+'"]')[0].style.display="";c.sort.functions.time.timeOfDay=a.toLowerCase();c.sort.functions.time.type="Starting Time";c.sort.functions.start()}})});
return{disabled:!1,activate:function(b){var a=document.getElementById("timeSort-ball-active"),f=a&&a.getAttribute("data-value");a&&(a.id="",document.querySelectorAll('[data-labelValue="'+f+'"]')[0].style.display="none");a=b.getAttribute("data-value");b.id="timeSort-ball-active";document.querySelectorAll('[data-labelValue="'+a+'"]')[0].style.display="";c.sort.functions.time.timeOfDay=a.toLowerCase();c.sort.functions.time.type="Starting Time";c.sort.functions.start()},disable:function(){a.style.opacity=
"0.4";c.view.controlPanel.timeSort.disabled=!0},enable:function(){a.style.opacity="1";c.view.controlPanel.timeSort.disabled=!1;c.sort.functions.type="Starting Time"}}}(CORE);
CORE.view.customElements.checkBoxes=function(c){var a={onClick:function(b){"false"==b.target.getAttribute("checked")?(b.target.setAttribute("checked",!0),b.target.classList.add("customCheckbox-checked")):(b.target.setAttribute("checked",!1),b.target.classList.remove("customCheckbox-checked"));a.globalExt(b)},globalExt:function(a){},addExt:function(a,c){[].slice.call(document.querySelectorAll('[data-uniqID="'+a+'"]')).forEach(function(a,b,h){a.addEventListener("mousedown",function(a){a.shiftKey||c&&
c(a)})})}};[].slice.call(document.getElementsByClassName("customCheck")).forEach(function(b,d,f){d=b.getAttribute("data-keep");var e={checked:!1,"class":""};d&&d.split(" ").forEach(function(a,c,d){e[a]=b.getAttribute(a)});e["class"]+=" customCheckBox";d=c.helper.element.createDiv(e);d.addEventListener("mousedown",a.onClick);b.parentNode.replaceChild(d,b)});return a}(CORE);
CORE.view.controlPanel.campusFilter=function(c){[{name:"Abbotsford",uniq:"ABBY",check:null},{name:"Chilliwack",uniq:"CHIL",check:null},{name:"Hope",uniq:"HOPE",check:null},{name:"Mission",uniq:"MIS",check:null},{name:"Clearbrook",uniq:"CLEAR",check:null},{name:"Online",uniq:"ONL",check:null}].forEach(function(a,b,d){c.view.customElements.checkBoxes.addExt(a.uniq,function(b){"true"==b.target.getAttribute("checked")?c.view.controlPanel.campusFilter.campusOn[a.uniq]=!0:c.view.controlPanel.campusFilter.campusOn[a.uniq]=
!1;c.filter.campus(a.uniq);c.sort.functions.start()})});return{campusOn:{ABBY:!0,CHIL:!0,HOPE:!0,MIS:!0,ONL:!0,CLEAR:!0}}}(CORE);
CORE.view.controlPanel.sortDrop=function(c){var a=document.getElementById("sort-dropDownList"),b=document.getElementById("sort-dropDownButton");document.addEventListener("click",function(a){if(c.view.controlPanel.sortDrop.down&&!a.target.classList.contains("sort-dropDownItem"))c.view.controlPanel.sortDrop.move.up();else if(a.target.classList.contains("sort-dropDownItem"))switch(document.querySelectorAll('[data-value="'+c.view.controlPanel.sortDrop.currentValue+'"]')[0].style.display="block",a.target.style.display=
"none",c.view.controlPanel.sortDrop.move.up(),c.view.controlPanel.sortDrop.setWords(a.target.getAttribute("data-value")),a.target.getAttribute("data-value")){case "Teacher Rating":c.sort.functions.type="Teacher Rating";c.view.controlPanel.timeSort.disable();c.sort.functions.start();break;case "Starting Time":c.sort.functions.type="Starting Time";c.view.controlPanel.timeSort.enable();c.sort.functions.start();break;case "Availability":c.sort.functions.type="Availability",c.view.controlPanel.timeSort.disable(),
c.sort.functions.start()}});b.addEventListener("click",function(d){d.stopPropagation();c.view.controlPanel.sortDrop.down?(b.style.backgroundImage="",c.view.controlPanel.sortDrop.down=!1,Velocity(a,"slideUp",100)):(b.style.backgroundImage="url(/images/upArrow.png)",c.view.controlPanel.sortDrop.down=!0,Velocity(a,"slideDown",100))});return{setWords:function(a){b.innerHTML='Sort By <label style="font-weight:100">|</label><label style="font-weight:300;"> '+a+"</label>";c.view.controlPanel.sortDrop.currentValue=
a},down:!1,currentValue:"Starting Time",move:{down:function(){b.style.backgroundImage="url(../images/upArrow.png)";c.view.controlPanel.sortDrop.down=!0;Velocity(a,"slideDown",100)},up:function(){b.style.backgroundImage="";c.view.controlPanel.sortDrop.down=!1;Velocity(a,"slideUp",100)}}}}(CORE);
CORE.view.toolTip=function(c){return{setUp:function(a){var b=document.getElementById("t-toolTipWrap");b.style.display="block";var c=document.body.getBoundingClientRect();a=a.target.getBoundingClientRect();var f=a.left-c.left;b.style.top=a.top-c.top+80+a.height+"px";b.style.left=f-150+"px";document.getElementById("t-toolTipTimes").innerHTML=""},onHover:function(a,b){var d=a.target.getAttribute("data-timeIndex");c.view.toolTip.setUp(a);var f={0:"Monday",1:"Tuesday",2:"Wednesday",3:"Thursday",4:"Friday",
5:"Saturday",6:"Sunday"},e=document.getElementById("t-toolTipCourseName");e.innerHTML=[b.courseName,b.lab?" - LAB":"",'<label style="float:right;">',b.section,"</label>"].join("");e.style.color=c.helper.color.getBackgroundColor(b.courseName);var h=document.getElementById("t-toolTipCRN"),g=document.getElementById("t-toolTipInstructor"),e=document.getElementById("t-toolTipRating"),k=document.getElementById("t-toolTipImage");h.innerHTML="CRN: "+b.crn;g.innerHTML=b.times[d].instructor;0<c.main.teacher.ratings.map[b.times[d].instructor]?
(k.style.background="",h=c.main.teacher.ratings.map[b.times[d].instructor],e.innerHTML=h.toFixed(3),h>=TEACHER_RATING_AVERAGE+STANDARD_DEVIATION/2?k.style.backgroundColor="#2ecc71":h<TEACHER_RATING_AVERAGE+STANDARD_DEVIATION/2&&h>=TEACHER_RATING_AVERAGE-STANDARD_DEVIATION/2?(k.style.backgroundPosition="-100px 0px",k.style.backgroundColor="#f1c40f"):TEACHER_RATING_AVERAGE-STANDARD_DEVIATION/2&&(k.style.backgroundPosition="-200px 0px",k.style.backgroundColor="#e74c3c")):(e.innerHTML="N/A",k.style.background=
"#DDD");for(e=0;e<b.times.length;e++)for(k=0;k<b.times[e].day.length&&-1!==b.times[d].day[k];k++)document.getElementById("t-toolTipTimes").innerHTML+=["<strong>",f[b.times[e].day[k]],": </strong>",c.helper.time.getTime(b.times[e].startTime)," - ",c.helper.time.getTime(b.times[e].endTime),"<br>"].join("")},onMove:function(a,b){document.getElementById("t-toolTipWrap").style.display="none"},add:function(a,b){var c=this;a.addEventListener("mouseover",function(a){c.onHover(a,b)});a.addEventListener("mouseout",
function(a){c.onMove(a,b)})}}}(CORE);
CORE.view.advanced=function(c){document.getElementById("advancedButton").addEventListener("click",function(a){a=document.getElementById("lowerControls");"none"==a.style.display?(Velocity(a,"slideDown",200),document.getElementById("advancedButton").children[0].style.backgroundImage="url(/images/upArrow.png)",document.getElementById("advancedButton").style.background="#9b59b6",document.getElementById("advancedButton").style.color="#FFF"):(Velocity(a,"slideUp",200),document.getElementById("advancedButton").children[0].style.backgroundImage=
"url(/images/downArrow.png)",document.getElementById("advancedButton").style.background="#fff",document.getElementById("advancedButton").style.color="#000")})}(CORE);
CORE.socket=function(c){var a=io("http://localhost:8080");a.on("crnData",function(a){a.forEach(function(a,b,e){c.socket.seatMap[a[0]]=JSON.parse(a[1]);[].forEach.call(document.getElementsByClassName("crn_"+a[0]),function(b,e,f){null!==c.socket.seatMap[a[0]]?(e=c.socket.seatMap[a[0]].m-c.socket.seatMap[a[0]].e,b.innerHTML=0>=e?c.socket.seatMap[a[0]].w+" waitlisted":e+" spot"+(1<e?"s":"")):b.innerHTML="unknown"})})});return{seatMap:{},socket:a,updateSeats:function(){for(var a in c.socket.seatMap){var d=
c.socket.seatMap[a];[].forEach.call(document.getElementsByClassName("crn_"+a),function(a,b,c){null!==d?(b=d.m-d.e,a.innerHTML=0>=b?d.w+" waitlisted":b+" spot"+(1<b?"s":"")):a.innerHTML="unknown"})}}}}(CORE);(function(){CORE.main.search.init(function(){CORE.main.teacher.functions.fetch(function(){CORE.sort.functions.type="Starting Time";CORE.view.controlPanel.timeSort.activate(document.getElementsByClassName("timeSort-ball")[0])});CORE.main.show.init()})})();
(function(){for(var c=document.getElementsByClassName("sliderCircle"),a=c.length;a--;)CORE.view.daySlider.elements[c[a].parentNode.getAttribute("data-day")].push(c[a])})();