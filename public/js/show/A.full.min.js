(function(n){CORE={raw:RAW_COURSE_DATA,crnMap:{},sort:{},profs:{},schedules:{all:[],current:[]},courses:[],helper:{color:{}},main:{search:{},sort:{},filter:{}},view:{sort:{},filter:{},schedule:{},render:{},menus:{}}};CORE.helper.color=function(e){return{bgColor:function(b){return randomColor({luminosity:"bright",format:"hex",seed:parseInt(b,36)%1E5})}}}(CORE);CORE.helper.element=function(e){return{editStyle:function(b,a){for(var c in a)b.style[c]=a[c]},create:function(b,a){var c=document.createElement(b);
void 0!==a.html&&(c.innerHTML=a.html,delete a.html);for(var f in a)c.setAttribute(f,a[f]);return c}}}(CORE);CORE.helper.time=function(e){return{inTime:function(b,a,c,f){return 0==b||0==c?!1:c>=b&&c<a||f>b&&f<a||b>=c&&b<f||a>c&&a<f?!0:!1},sameDay:function(b,a){if(-1==b[0]||-1==a[0])return!1;for(var c=0;c<b.length;c++)if(-1<a.indexOf(b[c]))return!0;return!1}}}(CORE);CORE.helper.array=function(e){return{hasFieldValue:function(b,a,c){for(var f=0;f<b.length;f++)if(b[f][a]==c)return b[f];return!1},uniq:function(b){for(var a=
{},c=[],f=0,g=b.length;f<g;++f)a.hasOwnProperty(b[f])||(c.push(b[f]),a[b[f]]=1);return c}}}(CORE);CORE.profs=function(e){var b=[];return{map:{},stitch:function(a,c,f){Object.keys(e.profs.map).length?f&&f(a,c,e.profs.map):b.push([a,c,f])},init:function(){var a=[];e.raw.forEach(function(c){a=a.concat(c.instructors)});a=e.helper.array.uniq(a);$.get({url:"/g/profs?names="+JSON.stringify(a),json:!0,done:function(a){for(a.map(function(a){e.profs.map[a.name]=a});b.length;)a=b.pop(),a[2](a[0],a[1],e.profs.map)}})}}}(CORE);
CORE.main.search=function(e){return{prep:function(){var b=[];e.raw.forEach(function(a){var c=[],f;for(f in a.sections)c.push(a.sections[f]);c.sort(function(a,c){return c.length-a.length});var g=[];a.mangled.forEach(function(a,b,f){var l={times:[]};a.forEach(function(a,b){b=0;for(var d=!1;!d&&4>b;)d=e.helper.array.hasFieldValue(c[b],"uniq",a),b++;l[b-1]=d;l.times=l.times.concat(d.times);l.length=b});l.times.length&&g.push(l)});b.push(g)});b.sort(function(a,b){return b.length-a.length});return e.courses=
b},start:function(){function b(a,c){if(0>c)return e.schedules.all.push(a);var f=e.courses[c],g=e.courses[c].length;a:for(;g--;){var k=a.length;for(f[g].times[0]&&-1!=f[g].times[0].days[0]||(k=0);k--;)for(var d=a[k].times.length;d--;)for(var h=f[g].times.length;h--;){var l=a[k].times[d],m=f[g].times[h];if(e.helper.time.inTime(l.start,l.end,m.start,m.end)&&e.helper.time.sameDay(l.days,m.days))continue a}0==c?e.schedules.all.push(a.concat(f[g])):b(a.concat(f[g]),c-1)}}e.courses[e.courses.length-1].forEach(function(a,
c){b([a],e.courses.length-2)});e.schedules.current=e.schedules.all},flatten:function(b){for(var a=[],c=0;c<b.length;c++)for(var f=0;f<b[c].length;f++)a.push(b[c][f]);return a}}}(CORE);CORE.sort=function(e){return{_currentSort:"time.mornings",go:function(b){if(b!=e.sort._currentSort){b&&(e.sort._currentSort=b);var a=e.sort.functions;e.sort._currentSort.split(".").forEach(function(b){a=a[b]});e.schedules.current.sort(a)}}}}(CORE);CORE.sort.functions=function(e){return{time:{mornings:function(b,a){for(var c=
0,f=0,g=0,e=0,d=b.length;d--;)for(var h=b[d].times.length;h--&&-1!=b[d].times[h].days[0];)c+=b[d].times[h].start*b[d].times[h].days.length,g+=b[d].times[h].days.length;for(d=a.length;d--;)for(h=a[d].times.length;h--&&-1!=a[d].times[h].days[0];)f+=a[d].times[h].start*a[d].times[h].days.length,e+=a[d].times[h].days.length;return c/g-f/e},noon:function(b,a){for(var c=0,f=0,g=0,e=0,d=b.length;d--;)for(var h=b[d].times.length;h--&&-1!=b[d].times[h].days[0];)c+=Math.abs(720-(b[d].times[h].start-b[d].times[h].end)/
2),g++;for(d=a.length;d--;)for(h=a[d].times.length;h--&&-1!=a[d].times[h].days[0];)f+=Math.abs(720-(a[d].times[h].start-a[d].times[h].end)/2),e++;return c/g-f/e},evenings:function(b,a){for(var c=0,f=0,g=0,e=0,d=b.length;d--;)for(var h=b[d].times.length;h--&&-1!=b[d].times[h].days[0];){try{c+=b[d].times[h].start*b[d].times[h].days.length}catch(l){console.log(b[d].times[h])}g+=b[d].times[h].days.length}for(d=a.length;d--;)for(h=a[d].times.length;h--&&-1!=a[d].times[h].days[0];)f+=a[d].times[h].start*
a[d].times[h].days.length,e+=a[d].times[h].days.length;return f/e-c/g},timeOfDay:"mornings"},teacherRating:function(b,a){for(var c=0,f=0,g=0,k=0,d=b.length;d--;)c+=e.main.teachers.map[b[d].times[0].instructor],g++;for(d=a.length;d--;)f+=e.main.teachers.map[a[d].times[0].instructor],k++;return f/k-c/g},availability:function(b,a){for(var c=0,f=0,g=b.length;g--;)var k=e.socket.seatMap[b[g].crn],d=k.m-k.e,c=c+(1E3*(0<d)-10*k.w+d*(0<d));for(g=a.length;g--;)k=e.socket.seatMap[a[g].crn],d=k.m-k.e,f+=1E3*
(0<d)-10*k.w+d*(0<d);return f-c},blockAmount:function(b,a){return a.times.length-b.times.length}}}(CORE);CORE.view.menus=function(e){var b=[{menu:document.getElementById("sort-dropDownList"),trigger:document.getElementById("sort-dropDownButton")},{menu:document.getElementById("lowerControls"),trigger:document.getElementById("advancedButton"),manual:!0}];return{menus:b,attach:function(){var a=this;b.forEach(function(b,f,e){b.trigger.addEventListener("click",function(){"block"!==b.menu.style.display?
(Velocity(b.menu,"slideDown",100),b.manual||a.outSlide(b.menu,b.trigger)):Velocity(b.menu,"slideUp",100)})})},outSlide:function(a,b){var f=function(e){a.contains(e.target)||e.target==a||b.contains(e.target)||e.target==b||(Velocity(a,"slideUp",100),document.removeEventListener("click",f))};document.addEventListener("click",f)}}}(CORE);CORE.view.sort=function(e){return{menus:[{menu:document.getElementById("sort-dropDownButton"),trigger:document.getElementById("sort-dropDownList")}],attach:function(){var b=
document.getElementById("sort-dropDownList"),a=document.getElementById("sort-dropDownLabel");[].forEach.call(document.getElementsByClassName("sort-dropDownItem"),function(c){c.addEventListener("click",function(){document.getElementsByClassName("sort-dropDownItem-active")[0].classList.remove("sort-dropDownItem-active");c.classList.add("sort-dropDownItem-active");a.innerHTML=c.getAttribute("data-value");Velocity(b,"slideUp",100);e.render(-1)})})}}}(CORE);CORE.view.filter=function(e){return{menus:[{menu:document.getElementById("sort-dropDownButton"),
trigger:document.getElementById("sort-dropDownList")}],attach:function(){}}}(CORE);CORE.render=function(e){var b=0,a=document.getElementById("main-scheduleContainer"),c=document.getElementById("main-loadingGear"),f={addTeacher:function(a,b){e.profs.stitch(a,b,function(b,c,e){a.getElementsByClassName("r-averageRatingTitle");a.getElementsByClassName("r-ratingContainer");c.instructors.forEach(function(a){document.getElementById("ratingWrapTemplate").cloneNode(!0).id=""})})},gen:function(a){var b=this,
d=document.getElementById("scheduleWrapTemplate").cloneNode(!0),c=d.getElementsByClassName("s-timeBlockWrap")[0];d.id="";a.forEach(function(a){a.times.forEach(function(d){var e=[],e=b.makeBlocks(d,a);e.forEach(function(a){c.appendChild(a)})});b.addTeacher(d,a)});console.log(d);return d},makeBlocks:function(a,b){var d=[];a.days.forEach(function(c){if(-1==c)return document.createElement("div");var f=e.helper.element.create("div",{"class":"s-timeBlock"});e.helper.element.editStyle(f,{top:[(a.start-480)/
2,"px"].join(""),left:[(c+1)%7*71,"px"].join(""),height:[(a.end-a.start)/2,"px"].join(""),lineHeight:[(a.end-a.start-4)/2,"px"].join(""),color:"#FFFFFF",backgroundColor:e.helper.color.bgColor(b.title)});f.innerHTML=b.title;d.push(f)});return d}};return function(g,k){g=g||b;k=k||10;c.style.display="block";if(-1===g){for(;a.children[0];)a.removeChild(a.children[0]);g++}for(var d=g;d<g+k;d++)a.appendChild(f.gen(e.schedules.current[d]));c.style.display="none";b=g+k}}(CORE);(function(){CORE.view.menus.attach();
CORE.view.sort.attach();CORE.view.filter.attach();CORE.profs.init();CORE.main.search.prep();CORE.main.search.start();CORE.schedules.current=CORE.schedules.current.map(function(e){return CORE.main.search.flatten(e)}).filter(function(e,b){return e.every(function(a){return!(void 0==a||"Closed"==a.status)})});CORE.sort.go();0<CORE.schedules.current.length&&CORE.render()})();n.CORE=CORE})(window);