extends ../MainTemplate

block headContent
    style.

        #mainContent{
            height:100%;
            width:1000px;
            margin-left:-500px;
            position:absolute;
            top:0px;
            left:50%;
        }
            #centerContainer{
                position:absolute;
                top:50%;
                margin-top:-250px;
                width:800px;
                margin-left:100px;
            }
                #mainTitle{
                    font-size:50px;
                    font-family:Raleway;
                    font-weight:100;
                    text-align:center;
                }
                #courseInput{
                    width:600px;
                    position:relative;
                    margin-left:-300px;
                    left:50%;
                    padding:10px;
                    border:1px solid #DDD;
                    font-family:Open Sans;
                    outline:0;
                    font-weight:300;
                    font-size:13px;
                }
                #scheduleCreate{
                    padding:5px;
                    border:3px solid rgba(255,255,255,0.1);
                    color:#FFF;
                    font-size:12px;
                    font-family:Open Sans;
                    width:150px;
                    background:#3498db;
                    margin-top:50px;
                    font-weight:400;
                    border-radius:2px;
                    cursor:pointer;
                }
                .clearfix:after {
                   content: " "; /* Older browser do not support empty content */
                   visibility: hidden;
                   display: block;
                   height: 0;
                   clear: both;
                }
                a{
                    color:inherit;
                    outline:0;
                    text-decoration:none;
                    }
                    ::-webkit-input-placeholder { /* WebKit browsers */
            color:    #888;
            opacity: 1 !important;
            }
                #instantDropDown{
                    width:100px;
                    border:1px solid #BBB;
                    display: none;
                    top:-1px;
                }
                    .instant-resultContainer{
                        padding:7px;
                        padding-left:10px;
                        cursor:pointer;
                        width:100%;
                        box-sizing:border-box;
                    }
                        .instant-resultContainer-hover{
                            background-color:#89C4F4;
                        }
                        .instant-resultCourseName{
                            font-family:Raleway;
                            font-size:13px;
                            font-weight:600;
                            display:inline-block;
                            margin-top:5px;
                        }
                        .instant-resultCourseCode{
                            font-family:Open Sans;
                            font-size:12px;
                            font-weight:300;
                            color:#666;
                            margin-left:10px;
                            display:inline-block;
                            margin-top:5px;
                        }
                        .courseChoice-wrap{
                            list-style-type:none;
                            display:block;
                        }
                        .courseChoice{
                            padding:10px;
                            border-radius:30px;
                            border:1px solid #000;
                            font-family:Open Sans;
                            font-size:12px;
                            font-weight:300;
                            display:block;
                            float:left;
                            margin:3px;
                        }
                        .courseKill{
                            background:url(/images/kill.png) center center no-repeat;
                            height:16px;
                            width:16px;
                            float:left;
                            display:inline-block;
                            margin-right:5px;
                            cursor:pointer;
                        }
                .seasonToolTip{
                    font-family:Open Sans;
                    font-size:12px;
                    font-weight:100;
                    color:#FFF;
                    background-color:#2c3e50;
                    padding:5px;
                    border-radius:3px;
                    position:absolute;
                }
    title="Create Schedule"
block bodyContent
    section#mainContent
        #termContainer(style="margin-left:30px;margin-top:120px;height:50px;z-index:100;width:800px;position:absolute;left:50%;margin-left:-400px;")
            #winterIcon.seasonIcon(data-term="winter 2016 (available)" style="height:42px;width:42px;padding:5px;box-sizing:border-box;border:1px solid #DDD;float:left;cursor:pointer;")
                img(src="/images/snowflake.png" width="30px")
            #summerIcon.seasonIcon(data-term="summer 2016 (coming soon)" style="height:42px;width:42px;padding:5px;box-sizing:border-box;border:1px solid transparent;float:left;cursor:pointer;margin-left:2px;opacity:0.2")
                img(src="/images/sun.png" width="30px")
            #fallIcon.seasonIcon(data-term="fall 2016 (coming later)" style="height:42px;width:42px;padding:5px;box-sizing:border-box;border:1px solid transparent;float:left;cursor:pointer;margin-left:2px;opacity:0.2")
                img(src="/images/leafIcon.png" width="30px")
        #centerContainer
            p#mainTitle Your Courses
            input#courseInput(type="text",placeholder="Enter your courses, e.g. Academic Writing, ENGL105")
            div#instantDropDown
            br
            br
            p(style="font-family:Open Sans;font-size:12px;font-weight:100;padding-left:100px;") Your Current Schedule Contains:
            ul#courseChoiceContainer(style="margin-left:100px;width:550px;padding-right:50px;float:left;")
            br
            div(style="width:100%;text-align:center")
                button#scheduleCreate(type="submit") Create Schedule
                button#scheduleCreate(type="submit" style="margin-left:20px;background:#2ecc71") Show Reviews


    footer
    script.
        CORE    =   {
            helper:{
                element:{
                
                }
            }
        }
        
        CORE.helper.element =  (function(CORE){
            return {
                changeStyle:function(element,styles){
                    for(var attributes in styles)
                        element.style[attributes]=styles[attributes];
                },
                createDiv:function(attributes){
                    var element =   document.createElement('div');
                    for(var attributeName in attributes)
                        element.setAttribute(attributeName,attributes[attributeName]);
                    return element;
                }
            }
        })(CORE);
        
        var courseInput =   {
            element:document.getElementById('courseInput'),
            pastValue:'',
            currentInstance:0,
            getValue:function(){
                return this.element.value
            },
            keypress:function(e){
                var currentValue    =   _CIthis.getValue();    
                if(currentValue==_CIthis.pastValue){
                    return;
                }
                _CIthis.pastValue  =   currentValue;
                _CIthis.currentInstance++;

                $.get({
                    url:'/s/get?courseInput='+currentValue,
                    done:function(e){
                        if(e.length==0){
                            dropDown.up();
                            return;
                        }

                        dropDown.load(e);
                        dropDown.drop();
                    }
                });
            },
            init:function(){
                 _CIthis   =   this;
                this.element.addEventListener('keyup',this.keypress);
            }
        }
        courseInput.init();

        var dropDown    =   {
            isDown:false,
            mainInput:courseInput,
            dropDown:document.getElementById('instantDropDown'),
            drop:function(){
                console.log(this.mainInput.getValue()=='')
                if(this.mainInput.getValue()!=''&&!this.isDown){
                    Velocity(this.dropDown,'slideDown',50);
                    this.isDown =   true;
                    return;
                }
                if(this.mainInput.getValue()==''&&this.isDown){
                    Velocity(this.dropDown,'slideUp',50);
                    this.isDown =   false;
                    return;
                }
            },
            up:function(){
                Velocity(this.dropDown,'slideUp',50);
                this.isDown =   false;
            },
            load:function(courses){
                var _this   =   this;
                
                //Remove all nodes in the dropdown
                
                    while(_this.dropDown.firstChild)
                        _this.dropDown.removeChild(_this.dropDown.firstChild);
                courses.forEach(function(v,i,a){
                    var instantContainer    =  CORE.helper.element.createDiv({class:'instant-resultContainer'});
                    var courseName  =   CORE.helper.element.createDiv({class:'instant-resultCourseName'});
                    var courseCode  =   CORE.helper.element.createDiv({class:'instant-resultCourseCode'});
                    
                    instantContainer.setAttribute('data-courseCode',v.courseCode);
                    courseName.innerHTML    =   v.courseName;
                    courseCode.innerHTML    =   v.courseCode;
                    
                    instantContainer.appendChild(courseName);
                    instantContainer.appendChild(courseCode); 
                    
                    _this.dropDown.appendChild(instantContainer);
                    instantContainer.addEventListener('click',function(){
                        chosenCourses.add(instantContainer.getAttribute('data-courseCode'));
                    });
                    instantContainer.addEventListener('mouseover',function(){
                        instantContainer.classList.add('instant-resultContainer-hover');
                    });
                    instantContainer.addEventListener('mouseout',function(){
                        instantContainer.classList.remove('instant-resultContainer-hover');
                    });
                });
            },
            getPos:function(el) {
                return {
                    x:el.offsetLeft,
                    y:el.offsetTop + el.offsetHeight,
                    width:el.offsetWidth
                };
            },
            flush:function(){
                this.dropDown.value='';
            },
            init:function(){
                this.isDown =   false;
                this.dropDown.style.position='relative';
                this.dropDown.style.width   =   parseInt(this.getPos(this.mainInput.element).width)-2+'px';
                this.dropDown.style.left   =   parseInt(this.getPos(this.mainInput.element).x)+'px';
            }
        }
        dropDown.init();

        var chosenCourses   =   {
            container:document.getElementById('courseChoiceContainer'),
            courseList:[],
            createButton:function(html){
                var li = document.createElement('li');
                var span    =   document.createElement('span');
                var img     =   document.createElement('div');

                img.className   =   'courseKill';
                img.setAttribute('onclick','chosenCourses.remove(this)');
                li.className='courseChoice-wrap';
                span.setAttribute('data-courseCode',html);
                span.className='courseChoice';
                span.appendChild(img);
                span.innerHTML+=html;
                li.appendChild(span);

                return li;
            },
            add:function(e){
                var courseCode  =   e;
                var button  =   chosenCourses.createButton(courseCode);
                var courseJSON  =   {};
                courseJSON.button   =   button;
                courseJSON.code =   courseCode;
                chosenCourses.courseList.push(courseJSON);
                chosenCourses.container.appendChild(button);
                dropDown.flush();
                dropDown.up();
                dropDown.mainInput.element.value='';
            },
            remove:function(e){
                chosenCourses.courseList    =   chosenCourses.courseList.filter(function(a){
                    return e.parentNode.getAttribute('data-courseCode')!==a.code
                });
                e.parentNode.parentNode.parentNode.removeChild(e.parentNode.parentNode);
                if(chosenCourses.courseList.length>0)
                    localStorage['oldCourses']=chosenCourses.courseList.map(function(a){return a.code}).join('.');
                else
                    localStorage['oldCourses']="";                
            }
        };

        var submit  =   {
            button:document.getElementById('scheduleCreate'),
            submit:function(){
                if(chosenCourses.courseList.length==0)
                    return false;
                var courseList  =   [];
                /*chosenCourses.courseList=chosenCourses.courseList.map(function(e){
                    courseList.push([e.code.split(/(\d)/).shift(),e.code.split(/(\d)/).splice(1).join('')]);
                    return e;
                });*/
                
                if(chosenCourses.courseList.length>0)
                    localStorage['oldCourses']=chosenCourses.courseList.map(function(a){return a.code}).join('.');
                else
                    localStorage['oldCourses']="";
                document.location   =   '/s/show/?c='+chosenCourses.courseList.join('|');
            },
            init:function(){
                this.button.addEventListener('click',this.submit)
            }
        }
        submit.init();
        document.location.hash='';
        if(localStorage['oldCourses'].length>0)
            localStorage['oldCourses'].split('.').forEach(function(v,i,a){
                chosenCourses.add(v);
            });
            
        [].forEach.call(document.getElementsByClassName('seasonIcon'),function(v,i,a){
            v.addEventListener('mouseover',function(){
                var top =   (v.getBoundingClientRect().top-35)+'px';
                var toolTip =   document.createElement('div');
                document.body.appendChild(toolTip);
                toolTip.className   =   'seasonToolTip';
                toolTip.innerHTML=v.getAttribute('data-term');
                var left    =   (v.getBoundingClientRect().left-(toolTip.getBoundingClientRect().width-v.getBoundingClientRect().width)/2)+'px';
                toolTip.style.top   =   top;
                toolTip.style.left =   left;
            });
            v.addEventListener('mouseout',function(){
                var a = document.getElementsByClassName('seasonToolTip');
                while(a.length){
                    a[0].parentNode.removeChild(a[0]);
                }
            });
        });